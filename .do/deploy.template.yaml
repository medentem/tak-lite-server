spec:
  name: tak-lite-server
  region: nyc

  services:
    - name: api
      dockerfile_path: Dockerfile
      source_dir: /
      git:
        branch: main
        repo_clone_url: https://github.com/medentem/tak-lite-server.git
      http_port: 3000
      instance_count: 1
      instance_size_slug: basic-xs
      envs:
        - key: NODE_ENV
          scope: RUN_TIME
          value: production
        - key: DATABASE_URL
          scope: RUN_AND_BUILD_TIME
          value: ${tak-lite-server-db.DATABASE_URL}
        - key: DATABASE_CA_CERT
          scope: RUN_AND_BUILD_TIME
          value: ${tak-lite-server-db.CA_CERT}
        - key: PGSSLMODE
          scope: RUN_AND_BUILD_TIME
          value: prefer
        - key: NODE_TLS_REJECT_UNAUTHORIZED
          scope: RUN_AND_BUILD_TIME
          value: "0"
        - key: JWT_SECRET
          scope: RUN_TIME
          type: SECRET
        - key: JWT_EXPIRES_IN
          scope: RUN_TIME
          value: 7d
        - key: DO_APP_URL
          scope: RUN_TIME
          value: "https://${app.name}.ondigitalocean.app"
        - key: LOG_LEVEL
          scope: RUN_TIME
          value: info
      health_check:
        http_path: /health
        initial_delay_seconds: 30
      routes:
        - path: /

  databases:
    - name: tak-lite-server-db
